{% extends 'discopro/base.html' %}

{% block title %}Detalle del Motorista{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="lista-h1">{{ motorista }}</h1>
    <div>
        <a href="{% url 'motorista_modificar' motorista.pk %}" class="btn btn-warning">Editar</a>
        <a href="{% url 'motorista_lista' %}" class="btn btn-secondary">Volver al listado</a>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header"><strong>Datos Personales Completos</strong></div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-5">Código Motorista</dt>
                    <dd class="col-sm-7">{{ motorista.codigo }}</dd>

                    <dt class="col-sm-5">Estado</dt>
                    <dd class="col-sm-7">
                        <span class="badge {% if motorista.estado == 'activo' %}bg-success{% elif motorista.estado == 'inactivo' %}bg-secondary{% else %}bg-warning text-dark{% endif %}">
                            {{ motorista.get_estado_display }}
                        </span>
                    </dd>

                    <dt class="col-sm-5">RUT</dt>
                    <dd class="col-sm-7">{{ motorista.rut }}</dd>
                    
                    <dt class="col-sm-5">Pasaporte</dt>
                    <dd class="col-sm-7">{{ motorista.pasaporte|default:"N/A" }}</dd>
                    
                    <dt class="col-sm-5">Nombre Completo</dt>
                    <dd class="col-sm-7">{{ motorista.nombres }} {{ motorista.apellido_paterno }} {{ motorista.apellido_materno }}</dd>
                    
                    <dt class="col-sm-5">Fecha Nacimiento</dt>
                    <dd class="col-sm-7">{{ motorista.fecha_nacimiento|date:"d-m-Y" }}</dd>
                    
                    <dt class="col-sm-5">Dirección</dt>
                    <dd class="col-sm-7">{{ motorista.direccion }}</dd>
                    
                    <dt class="col-sm-5">Ubicación</dt>
                    <dd class="col-sm-7">
                        {{ motorista.comuna.nombreComuna }}, <br>
                        Provincia {{ motorista.comuna.provincia.nombreProvincia }}, <br>
                        Región {{ motorista.comuna.provincia.region.nombreRegion }}
                    </dd>
                    
                    <dt class="col-sm-5">Teléfono</dt>
                    <dd class="col-sm-7">{{ motorista.telefono }}</dd>
                    
                    <dt class="col-sm-5">Correo</dt>
                    <dd class="col-sm-7">{{ motorista.correo }}</dd>
                    
                    <dt class="col-sm-5">¿Moto Personal?</dt>
                    <dd class="col-sm-7">
                        {% if motorista.incluye_moto_personal %}
                            <span class="badge bg-info text-dark">SÍ</span>
                        {% else %}
                            <span class="text-muted">NO</span>
                        {% endif %}
                    </dd>
                    
                    <dt class="col-sm-5">Licencia</dt>
                    <dd class="col-sm-7">
                        {% if motorista.licencia_conducir %}
                            <a href="{{ motorista.licencia_conducir.url }}" target="_blank">Ver Archivo</a>
                        {% else %}
                            No adjunta
                        {% endif %}
                    </dd>
                    
                    <dt class="col-sm-5">Último Control</dt>
                    <dd class="col-sm-7">{{ motorista.fecha_ultimo_control|date:"d-m-Y"|default:"-" }}</dd>
                    
                    <dt class="col-sm-5">Próximo Control</dt>
                    <dd class="col-sm-7">{{ motorista.fecha_proximo_control|date:"d-m-Y"|default:"-" }}</dd>
                </dl>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <strong>Contactos de Emergencia</strong>
                <a href="{% url 'crear_contacto_emergencia' motorista.pk %}" class="btn btn-sm btn-outline-secondary">Añadir</a>
            </div>
            <ul class="list-group list-group-flush">
                {% for contacto in contactos %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ contacto.nombreCompleto }}</strong> ({{ contacto.parentesco }})<br>
                            <i class="bi bi-telephone"></i> {{ contacto.telefono }}
                        </div>
                        <a href="{% url 'eliminar_contacto_emergencia' contacto.pk %}" class="btn btn-sm btn-outline-danger" title="Eliminar contacto">
                            <i class="bi bi-trash"></i>
                        </a>
                    </li>
                {% empty %}
                    <li class="list-group-item text-muted">No hay contactos registrados.</li>
                {% endfor %}
            </ul>
        </div>
        
        <div class="card mb-4">
            <div class="card-header"><strong>Historial de Farmacias</strong></div>
             <ul class="list-group list-group-flush" style="max-height: 200px; overflow-y: auto;">
                {% for asignacion in asignaciones_farmacia %}
                    <li class="list-group-item">
                        <strong>{{ asignacion.farmacia.nombre }}</strong>
                        <small class="text-muted d-block">Desde: {{ asignacion.fechaAsignacion|date:"d-m-Y H:i" }}</small>
                    </li>
                {% empty %}
                    <li class="list-group-item text-muted">Sin historial de asignaciones.</li>
                {% endfor %}
             </ul>
        </div>

        <div class="card mb-4">
            <div class="card-header"><strong>Historial de Motos</strong></div>
             <ul class="list-group list-group-flush" style="max-height: 200px; overflow-y: auto;">
                {% for asignacion in asignaciones_moto %}
                    <li class="list-group-item">
                        <strong>{{ asignacion.moto.patente }}</strong> ({{ asignacion.moto.marca }})
                        <small class="text-muted d-block">
                            Desde: {{ asignacion.fechaAsignacion|date:"d-m-Y H:i" }}
                            (Estado: {{ asignacion.estado }})
                        </small>
                    </li>
                {% empty %}
                    <li class="list-group-item text-muted">Sin historial de motos.</li>
                {% endfor %}
             </ul>
        </div>
    </div>
</div>
{% endblock %}