{% extends 'discopro/base.html' %}
{% load static %}

{% block title %}
  {% if form.instance.pk %}Editar Usuario{% else %}Crear Usuario{% endif %}
{% endblock %}

{% block content %}

<div class="form-container-center">
    <div class="form-card">
        
        <div class="form-card-header">
            <h2>
                <i class="bi bi-people-fill"></i>
                {% if form.instance.pk %}Editar Usuario{% else %}Crear Nuevo Usuario{% endif %}
            </h2>
        </div>

        <div class="form-card-body">
            <form method="post">
                {% csrf_token %}
                
                {% if form.non_field_errors %}
                  <div class="alert alert-danger">
                    {{ form.non_field_errors }}
                  </div>
                {% endif %}

                <h5 class="text-muted mb-3 pb-2 border-bottom">Datos Personales</h5>

                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label class="form-label">Nombres</label>
                      {{ form.first_name.as_widget }}
                      <div class="text-danger small">{{ form.first_name.errors }}</div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label class="form-label">Apellidos</label>
                      {{ form.last_name.as_widget }}
                      <div class="text-danger small">{{ form.last_name.errors }}</div>
                    </div>
                  </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                          <label class="form-label">RUT</label>
                          {{ form.rut.as_widget }}
                          <div class="text-danger small">{{ form.rut.errors }}</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                          <label class="form-label">Teléfono</label>
                          {{ form.telefono.as_widget }}
                          <div class="text-danger small">{{ form.telefono.errors }}</div>
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                  <label class="form-label">Correo Electrónico</label>
                  {{ form.email.as_widget }}
                  <div class="text-danger small">{{ form.email.errors }}</div>
                </div>
                
                <h5 class="text-muted mb-3 mt-4 pb-2 border-bottom">Rol y Permisos</h5>

                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label class="form-label">Rol Asignado</label>
                      {{ form.rol.as_widget }}
                      <div class="text-danger small">{{ form.rol.errors }}</div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-3 pt-4">
                      <div class="form-check form-switch">
                          {{ form.is_active }}
                          <label class="form-check-label" for="{{ form.is_active.id_for_label }}">
                              ¿Usuario Activo?
                          </label>
                      </div>
                      <div class="text-danger small">{{ form.is_active.errors }}</div>
                    </div>
                  </div>
                </div>
                
                <h5 class="text-muted mb-3 mt-4 pb-2 border-bottom">Credenciales de Acceso</h5>
                
                <div class="mb-3">
                  <label class="form-label">Nombre de Usuario (Login)</label>
                  {{ form.username.as_widget }}
                  <div class="text-danger small">{{ form.username.errors }}</div>
                </div>

                {% if form.password %}
                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label class="form-label">Contraseña</label>
                      {{ form.password.as_widget }}
                      
                      <small class="form-text text-muted" style="font-size: 0.85em;">
                          {{ form.password.help_text|safe }}
                      </small>
                      
                      <div class="text-danger small">{{ form.password.errors }}</div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label class="form-label">Confirmar Contraseña</label>
                      {{ form.confirmar_contrasena.as_widget }}
                      <div class="text-danger small">{{ form.confirmar_contrasena.errors }}</div>
                    </div>
                  </div>
                </div>
                {% endif %}
                <div class="form-actions mt-4 d-flex justify-content-end gap-2">
                    <a href="{% url 'usuario_lista' %}" class="btn btn-secondary">Cancelar</a>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-save"></i> Guardar Usuario
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('select').forEach(function(select) {
          select.classList.add('form-select');
      });
      document.querySelectorAll('input:not(.form-check-input)').forEach(function(input) {
          input.classList.add('form-control');
      });
  });
</script>
{% endblock %}